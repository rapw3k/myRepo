//>>built
define("rdforms/template/Converter",["dojo/_base/declare"],function(h){return h(null,{convertExhibit:function(a,b){this._load(a,dojo.hitch(this,function(a){b(this._convertExhibit(a))}))},constructor:function(a){this._itemStore=a},_load:function(a,b){dojo.xhrGet({url:a,sync:!0,handleAs:"json-comment-optional"}).addCallback(b)},_convertExhibit:function(a){var b=[],d=[];this._prepareExhibit(a);dojo.forEach(a.items,function(c){if("Property"===c.type){var e={id:c.id,property:c.id,label:{en:c.label},description:{en:c.description||
c.comment}};if(!c.ranges||c.ranges["http://www.w3.org/2000/01/rdf-schema#Literal"])e.type="text",e.nodetype="LANGUAGE_LITERAL";else{c=this._getPropertiesForClasses(a,c.ranges);var f=[],g;for(g in c)c.hasOwnProperty(g)&&f.push({id:g});e.type="group";e.automatic=!0;e.content=f}b.push(e)}else if("Class"===c.type){e={id:c.id,label:{en:c.label},description:{en:c.description||c.comment}};f={};f[c.id]=!0;c=this._getPropertiesForClasses(a,f);f=[];for(g in c)c.hasOwnProperty(g)&&f.push({id:g});0<f.length&&
(e.type="group",e.content=f,e.automatic=!0,d.push(e))}},this);this._itemStore._createItems(b);this._itemStore._createItems(d);return{properties:dojo.map(b,function(a){return a.id}),classes:dojo.map(d,function(a){return a.id})}},_prepareExhibit:function(a){a.domainProperties={};a.propertyIndex={};a.classIndex={};dojo.forEach(a.items,function(b){switch(b.type){case "Property":a.propertyIndex[b.id]=b;break;case "Class":a.classIndex[b.id]=b}});dojo.forEach(a.items,function(b){switch(b.type){case "Property":if(b.domain){var d=
a.domainProperties[b.domain]||{};d[b.id]=!0;a.domainProperties[b.domain]=d}d=b;do d.range&&(null==b.ranges&&(b.ranges={}),b.ranges[d.range]=!0),d=a.propertyIndex[d.subPropertyOf];while(d)}})},_getPropertiesForClasses:function(a,b){var d={},c;for(c in b)b.hasOwnProperty(c)&&a.classIndex[c]&&this._getPropertiesForClassesRecursive(a,a.classIndex[c],d,{});return d},_getPropertiesForClassesRecursive:function(a,b,d,c){if(!c[b.id]){c[b.id]=!0;var e=a.domainProperties[b.id],f;for(f in e)d[f]=!0;null!=b.subClassOf&&
(dojo.isArray(b.subClassOf)?dojo.forEach(b.subClassOf,function(b){a.classIndex[b]&&this._getPropertiesForClassesRecursive(a,a.classIndex[b],d,c)},this):a.classIndex[b.subClassOf]&&this._getPropertiesForClassesRecursive(a,a.classIndex[b.subClassOf],d,c))}}})});
//# sourceMappingURL=Converter.js.map