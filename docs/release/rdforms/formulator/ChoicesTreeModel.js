//>>built
define("rdforms/formulator/ChoicesTreeModel",["dojo/_base/lang","dojo/_base/declare","dojo/_base/array","../view/ChoicesTreeModel"],function(e,g,d,h){return g(h,{postscript:function(){this._detectTops()},_detectTops:function(){d.forEach(this.choices,function(a){delete a.top});var a=this._getChildren(this.root);a.length<this.choices.length&&d.forEach(a,function(a){a.top=!0})},getIdentity:function(a){return a===this.root?this.root.value:this.choiceIdx[a.value]?this.choiceIdx[a.value].id:(this._temporaryIdx||
{})[a.value]},newItem:function(a,b,c){this.choices.push(a);this.choiceIdx[a.value]={choice:a,id:this._newId()};b!==this.root&&(this.choiceIdx[a.value].parent=b,b.children=b.children||[],b.children.push({_reference:a.value}));this._detectTops();this.onChildrenChange(b,this._getChildren(b))},isNameFree:function(a){return null==this.choiceIdx[a]},renameItem:function(a,b){var c=a.value;if(c===b||this.choiceIdx[b])return!1;var f=this.choiceIdx[c];delete this.choiceIdx[c];this.choiceIdx[b]=f;a.value=b;
d.forEach(this.choices,function(a){a.children&&d.forEach(a.children,function(a){a._reference===c&&(a._reference=b)})});this.onChange(a)},removeItem:function(a,b){this._removeItem(a,b);this._detectTops();this.onChildrenChange(b,this._getChildren(b));setTimeout(e.hitch(this,function(){delete this._temporaryIdx},100))},_removeItem:function(a,b){var c=this.choices.indexOf(a);this.choices.splice(c,1);this._temporaryIdx=this._temporaryIdx||[];this._temporaryIdx[a.value]=this.choiceIdx[a.value].id;delete this.choiceIdx[a.value];
b.children=d.filter(b.children,function(b){return b._reference!==a.value});0===b.children.length&&delete b.children;a.children&&d.forEach(a.children,function(b){this._removeItem(this.choiceIdx[b._reference].choice,a)},this)},isItem:function(a){return-1!=this.choices.indexOf(a)},pasteItem:function(a,b,c,f,e){b!==c&&(b!==this.root&&(b.children=d.filter(b.children,function(b){return b._reference!==a.value}),0===b.children.length&&delete b.children),c!==this.root?(c.children=c.children||[],c.children.push({_reference:a.value}),
this.choiceIdx[a.value].parent=c):delete this.choiceIdx[a.value].parent,this._detectTops(),this.onChildrenChange(b,this._getChildren(b)),this.onChildrenChange(c,this._getChildren(c)))},onChange:function(a){},onChildrenChange:function(a,b){}})});
//# sourceMappingURL=ChoicesTreeModel.js.map