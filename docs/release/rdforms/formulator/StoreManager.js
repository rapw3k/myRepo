//>>built
require({cache:{"url:rdforms/formulator/StoreManagerTemplate.html":'\x3cdiv class\x3d"storeManager"\x3e\n    \x3cdiv data-dojo-type\x3d"dijit/layout/BorderContainer" data-dojo-attach-point\x3d"_bcDijit" style\x3d"height: 100%" data-dojo-props\x3d"gutters: false"\x3e\n        \x3cdiv data-dojo-type\x3d"dijit/layout/TabContainer" data-dojo-props\x3d"region:\'center\', gutters:true" data-dojo-attach-point\x3d"_tabsDijit" style\x3d"padding-top: 5px"\x3e\n            \x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" title\x3d"Template editor" data-dojo-attach-point\x3d"_itemEditorTab"\x3e\n                \x3cdiv data-dojo-attach-point\x3d"_editorNode"\x3e\x3c/div\x3e\n            \x3c/div\x3e\n            \x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" title\x3d"Template choices" data-dojo-attach-point\x3d"_choicesTab"\x3e\n                \x3cdiv data-dojo-attach-point\x3d"_choicesNode"\x3e\x3c/div\x3e\n            \x3c/div\x3e\n            \x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" title\x3d"Template source"\x3e\n                \x3ctextarea readonly data-dojo-attach-point\x3d"_contentsNode" class\x3d"maximized_textarea"\x3e\x3c/textarea\x3e\n            \x3c/div\x3e\n        \x3c/div\x3e\n        \x3cdiv data-dojo-type\x3d"dijit/layout/BorderContainer" data-dojo-props\x3d"region:\'left\', gutters: false,splitter:true" style\x3d"width: 20%;background: rgb(245, 245, 245);"\x3e\n            \x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-props\x3d"region:\'bottom\',splitter: false"\x3e\n                \x3cdiv data-dojo-type\x3d"dijit/form/Button" data-dojo-attach-point\x3d"_saveAllButton" data-dojo-attach-event\x3d"onClick: _saveTemplates" style\x3d"float:right"\x3eSave\x3c/div\x3e\n            \x3c/div\x3e\n            \x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-props\x3d"region:\'center\',splitter: false"\x3e\n                \x3cdiv data-dojo-attach-point\x3d"_treeNode" style\x3d"height: 100%;overflow-y: auto" class\x3d"itemList"\x3e\x3c/div\x3e\n            \x3c/div\x3e\n        \x3c/div\x3e\n        \x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-props\x3d"region:\'right\',splitter:true, gutters: false" style\x3d"width:40%;padding:5px 0px 0px 0px"\x3e\n            \x3cdiv data-dojo-attach-point\x3d"_previewNode" style\x3d"height:100%;overflow-y:auto;"\x3e\x3c/div\x3e\n        \x3c/div\x3e\n    \x3c/div\x3e\n\x3c/div\x3e\n'}});
define("rdforms/formulator/StoreManager","dojo/_base/declare dojo/_base/lang dojo/request/xhr dojo/on dojo/dom-class dojo/dom-construct dojo/dom-attr dojo/_base/array dojo/json dijit/registry dijit/layout/_LayoutWidget dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/dnd/Source dijit/tree/dndSource dijit/Tree dijit/Menu dijit/MenuItem dijit/MenuSeparator dijit/layout/ContentPane dijit/layout/TabContainer dijit/layout/BorderContainer dijit/form/Button ./ItemEditor ./ItemTreeModel ./ChoicesEditor ../template/Bundle ../template/Group ../template/Choice ../apps/Experiment dojo/text!./StoreManagerTemplate.html".split(" "),
function(s,e,t,G,H,l,q,h,m,g,u,v,w,I,x,y,z,k,A,J,K,L,M,B,C,D,f,n,r,E,F){return s([u,v,w],{itemStore:null,templateString:F,postCreate:function(){this.inherited("postCreate",arguments);this.itemStore.automaticSortAllowed=!1;this._buildTree()},startup:function(){this.inherited("startup",arguments);this._tabsDijit.watch("selectedChildWidget",e.hitch(this,function(b,d,c){c===this._itemEditorTab?this._showEditor():c===this._choicesTab?this._showChoices():this._showContent()}));(this.saveDisabled||h.every(this.itemStore.getBundles(),
function(b){return b.isReadOnly()}))&&this._saveAllButton.set("disabled",!0)},resize:function(){this.inherited("resize",arguments);this._bcDijit&&this._bcDijit.resize()},itemChanged:function(){this.tree.get("model").onChange(this.item);this._showContent()},_buildTree:function(){var b=this.itemStore,d=new C(b);this.tree=new y({showRoot:!1,model:d,dndController:x,checkItemAcceptance:function(a,p,c){a=g.getEnclosingWidget(a);var e=p.getSelectedTreeNodes()[0];if(a.item===b)return!1;p=e.item;e=e.getParent().item;
c="over"===c?a.item:a.getParent().item;return!(c instanceof n||c instanceof f)?!1:"N"!==d.getPasteAction(p,e,c)[0]},betweenThreshold:5,getRowClass:function(a){return a===b?"readOnly":(a instanceof f?a:a.getBundle()).isReadOnly()?"readOnly":"editable"},getIconClass:function(a,b){return!a||this.model.mayHaveChildren(a)?b?"dijitFolderOpened":"dijitFolderClosed":a instanceof r?"dijitIconConnector":"dijitLeaf"},onClick:e.hitch(this,function(a){null!=this._editor&&this._editor.destroy();this.item=a;this._showEditor();
this._showContent();this._showChoices()})},l.create("div",null,this._treeNode));this.tree.startup();this.menu&&this.menu.destroy();this.menu=new z({targetNodeIds:[this.tree.id],selector:".dijitTreeNode"});var c=e.hitch(this,function(a,c){if((a.item instanceof f?a.item:a.item.getBundle()).isReadOnly())alert("Cannot perform operation on read-only item.");else{var d=null==c;d&&(c=e.clone(a.item.getSource(!0)),delete c.id);a.item===b||a.item instanceof f?(c.id=""+(new Date).getTime(),this.__newItem(c,
a.item)):a.getParent().item instanceof f&&!(a.item instanceof n)?(c.id=""+(new Date).getTime(),this.__newItem(c,a.getParent().item)):a.item instanceof n&&!d?this.__newItem(c,a.item):(d=a.getParent().item,this.__newItem(c,d,d.getChildren().indexOf(a.item)+1))}});this.menu.addChild(new k({label:"New TextItem",iconClass:"dijitIconFile",onClick:function(){c(g.byNode(this.getParent().currentTarget),{type:"text",nodetype:"LITERAL"})}}));this.menu.addChild(new k({label:"New ChoiceItem",iconClass:"dijitIconConnector",
onClick:function(){c(g.byNode(this.getParent().currentTarget),{type:"choice",nodetype:"URI"})}}));this.menu.addChild(new k({label:"New GroupItem",iconClass:"dijitFolderOpened",onClick:function(){c(g.byNode(this.getParent().currentTarget),{type:"group",nodetype:"RESOURCE"})}}));this.menu.addChild(new k({label:"Clone Item",iconClass:"dijitFolderOpened",onClick:function(){c(g.byNode(this.getParent().currentTarget))}}));this.menu.addChild(new A);var h=e.hitch(this,function(a){a.item===b||a.item instanceof
f?alert("Cannot remove root or bundles!"):a.getParent().item instanceof f?a.item.getBundle().isReadOnly()?alert("Cannot remove read-only items."):(this.tree.get("model").removeItem(a.item,a.getParent().item),this.itemStore.removeItem(a.item)):a.getParent().item.getBundle().isReadOnly()?alert("Cannot remove read-only items."):this.tree.get("model").removeItem(a.item,a.getParent().item)});this.menu.addChild(new k({label:"Remove item",iconClass:"dijitEditorIcon dijitEditorIconDelete",onClick:function(){h(g.byNode(this.getParent().currentTarget))}}));
this.menu.startup()},_saveTemplates:function(){h.forEach(this.itemStore.getBundles(),function(b){b.isReadOnly()||t.put(b.getPath(),{data:m.stringify(b.getSource(),!0,"  "),headers:{"content-type":"application/json"}})})},_showEditor:function(){null!=this._editor&&this._editor.destroy();null!=this.item&&!(this.item instanceof f)&&(this._editor=new B({item:this.item,itemStore:this.itemStore,storeManager:this},l.create("div",null,this._editorNode)))},__newItem:function(b,d,c){d===this.itemStore||null==
d?(d=this.itemStore,b=this.itemStore.createItem(b,!1,!1,this.itemStore.getBundles()[0])):b=d instanceof f?this.itemStore.createItem(b,!1,!1,d):this.itemStore.createItem(b,!1,!0,d.getBundle());this.tree.get("model").newItem(b,d,c);d=this.tree.getNodesByItem(b)[0];d.getParent().expand();this.tree.focusNode(d);this.tree.set("selectedItem",b);this.item=b;this._showEditor();this._showContent();this._showChoices()},_showContent:function(){q.set(this._contentsNode,"value",m.stringify(this.item.getSource(!0),
!0,"  "));null!=this._editorDijit&&this._editorDijit.destroy();if(!(this.item instanceof f)){var b;b=this.item.getChildren?this.item:this.itemStore.createTemplateFromChildren([this.item]);this._editorDijit=new E({gutters:!1,hideTemplate:!0,template:b,graphObj:this.data},l.create("div",null,this._previewNode));this._editorDijit.startup();this._bcDijit.resize()}},_showChoices:function(){this._choicesEditor&&this._choicesEditor.destroy();this.item instanceof r&&(this._choicesEditor=new D({item:this.item},
l.create("div",null,this._choicesNode)),this._choicesEditor.onChange=e.hitch(this,this._showContent),this._choicesEditor.startup(),this._choicesEditor.resize())},_showAll:function(){var b=[];h.forEach(this.itemStore.getItems(),function(c){b.push(c.getSource(!0))},this);var d=m.stringify(b,!0,"  ");q.set(this._contentsNode,"value",d);null!=this._editorDijit&&this._editorDijit.destroy()}})});
//# sourceMappingURL=StoreManager.js.map